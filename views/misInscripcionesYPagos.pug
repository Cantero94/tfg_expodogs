extends layout/layout

block content
  .container.mt-5
    h1 Mis Inscripciones y Pagos

    if pagos.length
      .text-end.mb-3
        button.btn.btn-secondary#toggleAll Expandir Todos

      .accordion#accordionPagos
        each pago, index in pagos
          - const expo = pago.exposicion
          - const collapseId = `collapse-${pago.id_pago}`
          - const headingId = `heading-${pago.id_pago}`
          - const fecha = new Date(expo.fecha).toISOString().slice(0, 10)

          .accordion-item
            h2.accordion-header(id=headingId)
              button.accordion-button.collapsed.text-dark.bg-warning(type="button", data-bs-toggle="collapse", data-bs-target=`#${collapseId}`, aria-expanded="false", aria-controls=collapseId)
                b #{fecha} - #{expo.nombre} - Código: #{pago.cod_pago}

            .accordion-collapse.collapse(id=collapseId, aria-labelledby=headingId, data-bs-parent="#accordionPagos")
              .accordion-body
                if pago.agrupadas && Object.keys(pago.agrupadas).length
                  each inscripcionesPorRaza, raza in pago.agrupadas
                    h5.text-primary.mt-3 Raza: #{raza}
                    ul.list-group.mb-3
                      each insc in inscripcionesPorRaza
                        li.list-group-item
                          .fw-bold #{insc.perro.nombre} (#{insc.perro.sexo})
                          .text-muted Clase: #{insc.clase} | Tarifa: #{insc.tarifa_aplicada} | Precio: #{insc.precio.toFixed(2)}€
                else
                  .alert.alert-info.text-center No tienes inscripciones registradas.
                        
                hr
                p.fw-bold.mt-3 Total: #{pago.total.toFixed(2)}€
                .row.d-flex.justify-content-between.align-items-center.my-auto
                  .col-auto
                    p.mb-0 Estado:
                      span.badge(
                        class={
                          "bg-success": pago.estado === "pagado",
                          "bg-warning": pago.estado === "pendiente",
                          "bg-danger": pago.estado === "fallido"
                        }
                      ) #{pago.estado.toUpperCase()}
                  .col-auto.d-flex.flex-wrap.gap-2.align-items-stretch
                      a.btn.btn-danger.d-flex.align-items-center(href=`/generarPDF/${pago.cod_pago}`, target="_blank")
                        i.bi.bi-filetype-pdf.mx-2
                        | Descargar PDF
                      if pago.estado === "pendiente"
                        div
                          form(method="POST", action=`/pagar/${pago.cod_pago}`)
                            button(type="submit", class="btn btn-success d-flex align-items-center h-100")
                              i.bi.bi-credit-card.mx-2
                              | Pagar
    else
        .alert.alert-info.text-center No tienes inscripciones registradas.


block asidepanel
  include asidePanel
